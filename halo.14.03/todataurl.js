Number.prototype.toUInt=function(){return 0>this?this+4294967296:this},Number.prototype.bytes32=function(){return[255&this>>>24,255&this>>>16,255&this>>>8,255&this]},Number.prototype.bytes16sw=function(){return[255&this,255&this>>>8]},Array.prototype.adler32=function(a,b){switch(arguments.length){case 0:a=0;case 1:b=this.length-a}for(var c=1,d=0,e=0;b>e;e++)c=(c+this[a+e])%65521,d=(d+c)%65521;return(d<<16|c).toUInt()},Array.prototype.crc32=function(a,b){switch(arguments.length){case 0:a=0;case 1:b=this.length-a}var c=arguments.callee.crctable;if(!c){c=[];for(var d,e=0;256>e;e++){d=e;for(var f=0;8>f;f++)d=1&d?3988292384^d>>>1:d>>>1;c[e]=d.toUInt()}arguments.callee.crctable=c}for(var d=4294967295,g=0;b>g;g++)d=c[255&(d^this[a+g])]^d>>>8;return(4294967295^d).toUInt()},function(){var a=function(){var a=Array.prototype.slice.call(this.getContext("2d").getImageData(0,0,this.width,this.height).data),b=this.width,c=this.height,d=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82];Array.prototype.push.apply(d,b.bytes32()),Array.prototype.push.apply(d,c.bytes32()),d.push(8,6,0,0,0),Array.prototype.push.apply(d,d.crc32(12,17).bytes32());for(var e=c*(4*b+1),f=0;c>f;f++)a.splice(f*(4*b+1),0,0);var g=Math.ceil(e/32768);Array.prototype.push.apply(d,(e+5*g+6).bytes32());var h=d.length,i=e+5*g+6+4;d.push(73,68,65,84,120,1);for(var j=0;g>j;j++){var k=Math.min(32768,e-32768*j);d.push(j==g-1?1:0),Array.prototype.push.apply(d,k.bytes16sw()),Array.prototype.push.apply(d,(~k).bytes16sw());var l=a.slice(32768*j,32768*j+k);Array.prototype.push.apply(d,l)}return Array.prototype.push.apply(d,a.adler32().bytes32()),Array.prototype.push.apply(d,d.crc32(h,i).bytes32()),d.push(0,0,0,0,73,69,78,68),Array.prototype.push.apply(d,d.crc32(d.length-4,4).bytes32()),"data:image/png;base64,"+btoa(d.map(function(a){return String.fromCharCode(a)}).join(""))},b=HTMLCanvasElement.prototype.toDataURL;HTMLCanvasElement.prototype.toDataURL=function(){var d=b.apply(this,arguments);return"data:,"==d?(HTMLCanvasElement.prototype.toDataURL=a,this.toDataURL()):(HTMLCanvasElement.prototype.toDataURL=b,d)}}(),halo.add("todataurl",null);